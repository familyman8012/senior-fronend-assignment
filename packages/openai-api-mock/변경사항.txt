● 주요 변경사항:

  1. 스트림별 고유 ID: 각 스트림마다 고유한 ID를 생성하고 모든 청크에서 동일한 ID를 사용합니다.
  2. 스트림 상태 격리: Map을 사용하여 각 스트림의 상태를 독립적으로 관리합니다.
  3. abort 시 정리: 요청이 취소되면 해당 스트림의 상태를 즉시 정리합니다.
  4. 중복 체크: abort 플래그를 여러 곳에서 체크하여 취소된 스트림이 계속 실행되지 않도록 합니다.

  이제 ESC로 취소한 후 새 메시지를 보내면:
  - 이전 스트림은 완전히 중단되고 정리됩니다
  - 새 스트림은 고유한 ID로 시작되어 이전 스트림과 섞이지 않습니다
  - 각 스트림의 상태가 독립적으로 관리되어 충돌이 없습니다

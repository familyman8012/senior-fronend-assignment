# 오프라인 모드 가이드

## 개요

이 AI 채팅 인터페이스는 **PWA(Progressive Web App)** 기술을 활용하여 오프라인 환경에서도 사용할 수 있도록 구현되었습니다. 사용자가 인터넷 연결이 없는 상황에서도 기존에 저장된 채팅 히스토리를 조회할 수 있습니다.

## 오프라인 모드에서 제공하는 기능

### ✅ 가능한 기능
- **채팅 히스토리 조회**: localStorage에 저장된 모든 과거 대화 내용 확인
- **세션 간 탐색**: 여러 채팅 세션 간 이동 및 내용 확인
- **메시지 검색**: 저장된 메시지 내에서 검색 (기본 브라우저 검색 기능 활용)
- **UI 인터랙션**: 모든 인터페이스 요소 정상 동작
- **앱 설치**: PWA로 설치하여 네이티브 앱처럼 사용 가능

### ❌ 제한되는 기능
- **새 메시지 전송**: AI와의 새로운 대화 불가
- **메시지 재생성**: 기존 메시지 재생성 불가
- **메시지 편집**: 기존 메시지 편집 후 재전송 불가
- **실시간 스트리밍**: 새로운 응답 스트리밍 불가

## PWA(Progressive Web App) 구현

### 왜 PWA를 선택했는가?
1. **크로스 플랫폼**: 모든 기기에서 동일한 경험 제공
2. **앱 설치**: 홈 화면에 설치하여 네이티브 앱처럼 사용
3. **오프라인 지원**: 서비스 워커를 통한 강력한 오프라인 기능
4. **빠른 개발**: 네이티브 앱 개발 대비 빠른 구현 가능

### 구현된 PWA 기능
- **Service Worker**: 앱 셸과 정적 리소스 캐싱
- **Web App Manifest**: 앱 설치 및 메타데이터 정의
- **Offline Fallback**: 오프라인 상태에서의 폴백 처리
- **App Shell Architecture**: 핵심 UI 구조 사전 캐싱

## 개발 서버에서 테스트하는 방법

### 1. 개발 서버 실행
```bash
cd packages/web-ui
pnpm dev
```

### 2. 오프라인 시뮬레이션 (제한적)
1. Chrome DevTools 열기 (F12)
2. **Application** 탭 → **Service Workers**
3. "Offline" 체크박스 활성화
4. 페이지 새로고침

⚠️ **주의사항**: 개발 서버에서는 완전한 오프라인 테스트가 어려움
- Vite 개발 서버는 번들링되지 않은 모듈을 제공
- HMR(Hot Module Replacement) 등의 개발 전용 기능이 포함됨

### 3. 정확한 테스트 방법
```bash
# 1. 빌드 실행
pnpm build

# 2. 프리뷰 서버 실행
pnpm preview
```

프리뷰 서버에서 테스트하면 실제 배포 환경과 동일한 조건에서 PWA 기능을 확인할 수 있습니다.

## 배포 후 사용 방법

### 1. 웹 브라우저에서 사용
1. HTTPS 서버에 배포된 사이트 접속
2. 몇 번 채팅 후 페이지 새로고침 (캐싱 완료)
3. 네트워크 연결 끊기
4. 사이트 재방문 → 저장된 채팅 히스토리 확인 가능

### 2. PWA 앱으로 설치
1. Chrome 브라우저에서 사이트 접속
2. 주소창 오른쪽의 설치 아이콘 클릭
3. "설치" 버튼 클릭
4. 홈 화면에 앱 아이콘 생성됨

### 3. 오프라인에서 앱 실행
1. 네트워크 연결 없이 설치된 앱 실행
2. 모든 UI 정상 동작
3. 저장된 채팅 히스토리 조회 가능
4. 오프라인 상태 표시: "오프라인 모드: 저장된 대화만 볼 수 있습니다"

## 기술적 구현 사항

### Service Worker 캐싱 전략
```javascript
// 정적 리소스 사전 캐싱
const urlsToCache = [
  '/',
  '/index.html',
  '/manifest.json'
];

// 동적 캐싱: CSS, JS 파일
// API 요청은 캐싱하지 않음
```

### 오프라인 상태 감지
```javascript
// useNetworkStatus 훅 활용
const { isOnline } = useNetworkStatus();

// 오프라인 시 UI 업데이트
if (!isOnline) {
  // 입력창 비활성화
  // 오프라인 메시지 표시
}
```

### 데이터 저장소
- **localStorage**: 채팅 세션 및 메시지 저장
- **Service Worker Cache**: 정적 리소스 캐싱
- **IndexedDB**: 현재 미사용 (필요시 확장 가능)

## 제한사항 및 고려사항

### 현재 제한사항
1. **개발 서버 한계**: 완전한 오프라인 테스트 불가
2. **아이콘 미구현**: PWA 아이콘 파일 없음 (브라우저 기본 아이콘 사용)
3. **푸시 알림**: 구현되지 않음
4. **백그라운드 동기화**: 구현되지 않음

### 확장 가능한 기능
1. **오프라인 메시지 큐**: 오프라인에서 작성한 메시지를 온라인 복구 시 자동 전송
2. **IndexedDB 마이그레이션**: 더 큰 저장 공간과 구조화된 데이터 관리
3. **캐시 전략 개선**: 이미지, 폰트 등 추가 리소스 캐싱
4. **설치 프롬프트**: 커스텀 설치 안내 UI

## 브라우저 지원

### 완전 지원
- Chrome 67+
- Firefox 61+
- Safari 11.1+
- Edge 17+

### 부분 지원
- 일부 모바일 브라우저에서 PWA 설치 제한

## 문제 해결

### 서비스 워커가 업데이트되지 않을 때
```javascript
// Chrome DevTools → Application → Service Workers
// "Update on reload" 체크
// 또는 "Unregister" 후 페이지 새로고침
```

### 오프라인 테스트가 작동하지 않을 때
1. HTTPS 환경에서 테스트 (localhost는 예외)
2. 빌드 후 프리뷰 서버 사용
3. 브라우저 캐시 및 서비스 워커 초기화

---

이 오프라인 모드는 면접 과제의 범위에 맞춰 핵심 기능에 집중하여 구현되었습니다. 사용자는 인터넷 연결이 없는 환경에서도 기존 채팅 히스토리를 편리하게 확인할 수 있습니다.